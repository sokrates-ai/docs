(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[61],{7870:(e,s,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dev/backend-migrations",function(){return i(1953)}])},1953:(e,s,i)=>{"use strict";i.r(s),i.d(s,{__toc:()=>o,default:()=>h});var r=i(5893),n=i(2673),t=i(2643),a=i(208);let o=[{depth:2,value:"Prerequisites",id:"prerequisites"},{depth:2,value:"General Concepts",id:"general-concepts"},{depth:2,value:"Adding Migrations",id:"adding-migrations"},{depth:3,value:"Navigate to your backend directory at apps/api",id:"navigate-to-your-backend-directory-at-appsapi"},{depth:3,value:"Perform Changes In The DB",id:"perform-changes-in-the-db"},{depth:3,value:"Check Migrations History",id:"check-migrations-history"},{depth:3,value:"Perform all the Migrations",id:"perform-all-the-migrations"}];function l(e){let s=Object.assign({h1:"h1",p:"p",h2:"h2",ul:"ul",li:"li",a:"a",h3:"h3",code:"code",pre:"pre",span:"span"},(0,t.a)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h1,{children:"Backend Migrations"}),"\n",(0,r.jsx)(s.p,{children:"This is a guide to use migrations for LearnHouse, it will walk you through the process of using migrations in the backend."}),"\n",(0,r.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://docs.docker.com/get-docker/",children:"Docker"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://www.python.org/downloads/",children:"Python 3.12.x"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://python-poetry.org/docs/",children:"Poetry"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://alembic.sqlalchemy.org/en/latest/",children:"Alembic"})}),"\n",(0,r.jsx)(s.li,{children:"macOS, Linux or Windows"}),"\n"]}),"\n",(0,r.jsx)(a.UW,{type:"info",children:(0,r.jsxs)(s.p,{children:["For details on setting up the backend dev environment, see ",(0,r.jsx)(s.a,{href:"/dev/setup-dev-environment",children:"Setting Up Your Dev Environment"})]})}),"\n",(0,r.jsx)(s.h2,{id:"general-concepts",children:"General Concepts"}),"\n",(0,r.jsxs)(s.p,{children:["Generally, we use Alembic for SQL migrations.\nMake sure to check out their ",(0,r.jsx)(s.a,{href:"https://alembic.sqlalchemy.org/en/latest/tutorial.html",children:"tutorial"})," if you have never used it before."]}),"\n",(0,r.jsx)(s.h2,{id:"adding-migrations",children:"Adding Migrations"}),"\n",(0,r.jsxs)(a.Rg,{children:[(0,r.jsxs)(s.h3,{id:"navigate-to-your-backend-directory-at-appsapi",children:["Navigate to your backend directory at ",(0,r.jsx)(s.code,{children:"apps/api"})]}),(0,r.jsx)(s.p,{children:"Then use the following command to indicate that the database is already using the newest state."}),(0,r.jsx)(a.UW,{type:"warning",children:(0,r.jsx)(s.p,{children:"Make sure that the production app (in the container stack) was running at least once.\nThis way, you can guarantee that the DB is up-to-date."})}),(0,r.jsx)(s.pre,{"data-language":"bash","data-theme":"default",children:(0,r.jsx)(s.code,{"data-language":"bash","data-theme":"default",children:(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"poetry"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"run"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"alembic"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"stamp"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"head"})]})})}),(0,r.jsx)(s.h3,{id:"perform-changes-in-the-db",children:"Perform Changes In The DB"}),(0,r.jsx)(s.p,{children:'Perform any change on the schema of the database, you could add a table for the "Example" feature, for instance.\nTo generate a revision with the changes you did on your DB.'}),(0,r.jsx)(s.pre,{"data-language":"bash","data-theme":"default",children:(0,r.jsx)(s.code,{"data-language":"bash","data-theme":"default",children:(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"poetry"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"run"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"alembic"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"revision"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"--autogenerate"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"-m"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Example"'})]})})}),(0,r.jsx)(s.h3,{id:"check-migrations-history",children:"Check Migrations History"}),(0,r.jsx)(s.p,{children:"Check your migrations history"}),(0,r.jsx)(s.pre,{"data-language":"bash","data-theme":"default",children:(0,r.jsx)(s.code,{"data-language":"bash","data-theme":"default",children:(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"poetry"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"run"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"alembic"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"history"})]})})}),(0,r.jsx)(s.h3,{id:"perform-all-the-migrations",children:"Perform all the Migrations"}),(0,r.jsx)(s.p,{children:"Do all the migrations"}),(0,r.jsx)(s.pre,{"data-language":"bash","data-theme":"default",children:(0,r.jsx)(s.code,{"data-language":"bash","data-theme":"default",children:(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"poetry"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"run"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"alembic"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"upgrade"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"head"})]})})}),(0,r.jsxs)(s.p,{children:["In order to check the migrations, visit a local directory that maps to ",(0,r.jsx)(s.a,{href:"https://github.com/learnhouse/learnhouse/tree/dev/apps/api/migrations",children:"this path"}),"."]})]}),"\n",(0,r.jsx)(a.UW,{type:"info",children:(0,r.jsxs)(s.p,{children:["For downgrading the latest migration, you can use ",(0,r.jsx)(s.code,{children:"alembic downgrade -2"}),".\nMake sure to consult the Alembic docs for further information."]})})]})}let h=(0,n.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,t.a)(),e.components);return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(l,{...e})}):l(e)},pageOpts:{filePath:"pages/dev/backend-migrations.mdx",route:"/dev/backend-migrations",timestamp:1732469189e3,title:"Backend Migrations",headings:o},pageNextRoute:"/dev/backend-migrations"})}},e=>{var s=s=>e(e.s=s);e.O(0,[673,888,774,179],()=>s(7870)),_N_E=e.O()}]);